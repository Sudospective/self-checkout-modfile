<Mods LoadCommand = "%xero(function(self)
	-- judgment / combo proxies
	for pn = 1, 2 do
		setupJudgeProxy(PJ[pn], P[pn]:GetChild('Judgment'), pn)
		setupJudgeProxy(PC[pn], P[pn]:GetChild('Combo'), pn)
	end
	-- player proxies
	for pn = 1, #PP do
		PP[pn]:SetTarget(P[pn])
		P[pn]:hidden(1)
		P[pn]:SetFarDist(100000)
	end
	
	local SineS, CubicS, QuintS, CircS, ElasticS, QuadS, QuartS, ExpoS, BackS, BounceS 
	= inOutSine, inOutCubic, inOutQuint, inOutCirc, inOutElastic, inOutQuad, inOutQuart, inOutExpo, inOutBack, inOutBounce
	
-------------------------------------- bg stuff ---------------------------------------------------

	CheckoutBg:x(SCREEN_CENTER_X)
	CheckoutBg:y(SCREEN_CENTER_Y)
	CheckoutBg:diffuse(0.35, 0.35, 0.65, 1)
	
	CheckoutBg:zoomtowidth(SCREEN_WIDTH)
	CheckoutBg:zoomtoheight(SCREEN_HEIGHT)
	CheckoutFog:zoomtowidth(SCREEN_WIDTH)
	CheckoutFog:zoomtoheight(SCREEN_HEIGHT)
	
	CheckoutFog:x(SCREEN_CENTER_X)
	CheckoutFog:y(SCREEN_CENTER_Y)
	CheckoutFog:customtexturerect(0,0,1,1)
	CheckoutFog:texcoordvelocity(0,0.1)
	CheckoutFog:diffuse(0, 0, 0.5, 0.5)
	CheckoutFog:blend('add')
	
-------------------------------------- definemod stuff ---------------------------------------------------
	
	definemod {'bgzoom','bgkick', function(zm,k)
		CheckoutBg:zoom(1+zm+k)
		CheckoutFog:zoom(1.5+zm+k)
	end}
	
	definemod {'bgrotx','bgroty','bgrotz', function(p,pp,ppp)
		CheckoutBg:rotationx(p)
		CheckoutBg:rotationy(pp)
		CheckoutBg:rotationz(ppp)
		
		CheckoutFog:rotationx(p)
		CheckoutFog:rotationy(pp)
		CheckoutFog:rotationz(ppp)
	end}
	
	local last_scan_pos = 0
	definemod {'scanlinepos', 'scanlinealpha', function(y, a)
		ScanLine:y(-scy * 0.05 + (sh * (y * 0.011)))
		ScanLine:diffusealpha(a * 0.01)
		if ScanLine:GetY() > last_scan_pos then
			ScanLine:fadetop(0.5)
			ScanLine:fadebottom(0.5)
		else
			ScanLine:fadetop(0.5)
			ScanLine:fadebottom(0.5)
		end
		last_scan_pos = ScanLine:GetY()
		--ScanSprite:diffusealpha(a * 0.005)
		P1Sprite:diffusealpha(a * 0.01)
		P2Sprite:diffusealpha(a * 0.01)
		P1Sprite:cropbottom(y * 0.01)
		P2Sprite:croptop(1 - (y * 0.01))

	end}

-------------------------------------- fg stuff ---------------------------------------------------

	aft(ScanAFT)
	sprite(ScanSprite)
	aftsprite(ScanAFT, ScanSprite)
	ScanSprite:diffusealpha(0.25)
	BG1:SetTarget(CheckoutBGFrame)
	BG2:SetTarget(CheckoutBGFrame)
	ScanP1:SetTarget(P[1])
	ScanP2:SetTarget(P[2])

	aft(P1AFT)
	aft(P2AFT)
	sprite(P1Sprite)
	sprite(P2Sprite)
	aftsprite(P1AFT, P1Sprite)
	aftsprite(P2AFT, P2Sprite)

	
end)"
Type = "ActorFrame"
><children>

	<Layer Type = "ActorProxy" Name = "BG2" />
	<Layer Type = "ActorProxy" Name = "ScanP2" />
	<Layer Type = "ActorFrameTexture" Name = "P2AFT" />
	<Layer Type = "ActorProxy" Name = "BG1" />
	<Layer Type = "ActorProxy" Name = "ScanP1" />
	<Layer Type = "ActorFrameTexture" Name = "P1AFT" />
	
	<Layer Type = "ActorFrame" Name = "CheckoutBGFrame">
		<children>
		<Layer File="bg/background" Name="CheckoutBg"/>
		<Layer File="bg/cloud.png" Name="CheckoutFog"/>
		</children>
	</Layer>

	<Layer File="nitgfan.xml"/>
	<Layer File="sudo.xml"/>

	<Layer Type = "ActorProxy" Name = "PP[1]" />
	<Layer Type = "ActorProxy" Name = "PP[2]" />
	<Layer Type = "Sprite" Name = "P1Sprite" />
	<Layer Type = "Sprite" Name = "P2Sprite" />
	<Layer Type = "ActorProxy" Name = "PC[1]" />
	<Layer Type = "ActorProxy" Name = "PJ[1]" />
	<Layer Type = "ActorProxy" Name = "PC[2]" />
	<Layer Type = "ActorProxy" Name = "PJ[2]" />

	<Layer Type = "Sprite" Name = "ScanSprite" />
	<Layer
		Type = "Quad"
		Name = "ScanLine"
		OnCommand = "%xero(function(self)
			self:xy(scx, 0)
			self:SetWidth(sw)
			self:SetHeight(32)
			self:diffuse(0, 1, 0, 1)
		end)"
	/>
	<Layer Type = "ActorFrameTexture" Name = "ScanAFT" />

</children></Mods>
